---
# Unified stack backup: appdata + databases in a single invocation.
# Wraps backup_hosts.yaml (per-stack appdata) and backup_databases.yaml (DB dumps).
#
# Scope selectors pass through to backup_hosts.yaml for appdata:
#   role=<name>   — back up all stacks in a role
#   stack=<name>  — back up a single stack
#   app=<name>    — back up a single app's stack
#
# DB backups always run for ALL databases regardless of role/stack scope.
# Partial DB backup risks cross-database inconsistency.
#
# Usage:
#   ansible-playbook backup_stacks.yaml
#   ansible-playbook backup_stacks.yaml -e role=core
#   ansible-playbook backup_stacks.yaml -e stack=auth

- import_playbook: backup_hosts.yaml
  vars:
    hosts_variable: docker_stacks

- import_playbook: backup_databases.yaml
  vars:
    hosts_variable: db_primary_mariadb

- import_playbook: backup_databases.yaml
  vars:
    hosts_variable: db_primary_postgres
