src_raw_files:
  - "/opt"

backup_name: "Docker"
backup_description: "Automatic Docker Appdata Backup"
backup_subtype: "Appdata"

# Update vars
update_name: "Docker"
update_description: "Automatic Docker Container Update"
update_type: "Servers"
update_subtype: "Container"
update_delay_days: 3
update_exclude_services:
  - semaphore

# App definitions — apps with external dependencies (DB, companion containers).
# Used by restore_app.yaml (production), test_backup_restore.yaml (test), and
# resolve_scope.yaml (app → stack scope selector). Only contains what must be
# known BEFORE containers run (archive discovery on controller).
# All runtime restore config (DB engine, health URLs) lives in container labels.
app_definitions:
  authentik:
    stack: auth
    db_stack: databases
    db_config: db_primary_postgres
    db_names: [authentik]
  jellyseerr:
    stack: media
    db_stack: databases
    db_config: db_primary_postgres
    db_names: [jellyseerr]

# Stack assignments: host → ordered list of stack names.
# Derived from host_roles + stack_roles (both from vars/vm_definitions.yaml).
stack_assignments: >-
  {{ dict(
    host_roles | dict2items | map(attribute='key') | list
    | zip(
      host_roles | dict2items | map(attribute='value')
      | map('extract', stack_roles) | list
    )
  ) }}

# Backup order: least-critical stacks first so auth/databases go down last.
# Derived as reverse of stack_assignments per role.
backup_stack_order: >-
  {{ dict(
    host_roles | dict2items | map(attribute='key') | list
    | zip(
      host_roles | dict2items | map(attribute='value')
      | map('extract', stack_roles)
      | map('reverse') | map('list') | list
    )
  ) }}

# Docker defaults — non-secret, shared across all stacks.
# docker_mem_limit scales with host RAM — replaces static group_vars overrides.
docker_mem_limit: >-
  {{ '10g' if ansible_memtotal_mb | default(0) | int > 12000
     else '6g' if ansible_memtotal_mb | default(0) | int > 6000
     else '3000m' }}
docker_tz: "America/Chicago"
docker_puid: "1000"
docker_pgid: "1000"
docker_umask: "022"
docker_appsdir: "/opt"
docker_restart: "always"
docker_postgres_user: "postgres"
docker_postgres_default_db: "postgres"
docker_adminer_design: "hydra"
docker_authentik_image: "ghcr.io/goauthentik/server"
docker_authentik_tag: "2025.12.4"
docker_email_host: "smtp.gmail.com"
docker_email_port: 587
docker_dozzle_level: "info"
