src_raw_files:
  - "/opt"

backup_tmp_dir: "/backup"
backup_name: "Docker"
backup_description: "Automatic Docker Appdata Backup"
backup_type: "Servers"
backup_subtype: "Appdata"

# Per-stack TCP ports to wait for after docker compose up.
# Any stack listed here will have its ports polled before the deploy task returns.
# Add entries for stacks that expose ports that downstream stacks depend on.
stack_wait_ports:
  databases: [3306, 5432]

# Per-stack backup paths — appdata directories to archive for each stack.
# /opt/stacks/{name}/ is always included automatically (compose + .env).
# DB data dirs (mariadb, postgres, influxdb) are excluded — they have dedicated SQL dump jobs.
stack_backup_paths:
  infra:
    - /opt/beszel_socket
  databases:
    - /opt/adminer
  auth:
    - /opt/authentik_worker
    - /opt/swag
    - /opt/crowdsec
  monitoring:
    - /opt/grafana
  dev:
    - /opt/code-server
    - /opt/netboot
  media:
    - /opt/tautulli
    - /opt/jellyseerr
  apps:
    - /opt/home_assistant
    - /opt/guacamole
    - /opt/firefox
    - /opt/xbackbone
    - /opt/homepage
    - /opt/homebox
    - /opt/cloudflareddns
  nfs: []
  vpn:
    - /opt/wireguard
    - /opt/npm
    - /opt/npm-le
    - /opt/beszel

# Update vars
update_name: "Docker"
update_description: "Automatic Docker Container Update"
update_type: "Servers"
update_subtype: "Container"
update_delay_days: 3
update_exclude_services:
  - semaphore

# Restore support — maps app names to containers, DB config, and DB host.
# Used by restore_hosts.yaml for selective and coordinated DB+appdata restore.
app_restore:
  authentik:
    containers: ["authentik", "authentik_worker"]
    db_config_file: db_primary_postgres
    db_host: "{{ db_host_primary }}"
    db_names: ["authentik"]
  jellyseerr:
    containers: ["jellyseerr"]
    db_config_file: db_primary_postgres
    db_host: "{{ db_host_primary }}"
    db_names: ["jellyseerr"]

# Stack assignments: host → ordered list of stack names.
# ORDER MATTERS: on tantive-iv, databases MUST precede auth (Authentik requires Postgres).
# Keys are inventory_hostname (FQDNs) — must be set in vault as vault_stack_assignments.
# Example structure:
#   vault_stack_assignments:
#     <vps-fqdn>:      [vpn]
#     <odyssey-fqdn>:  [infra, media, apps, nfs]
#     <tantiveiv-fqdn>: [infra, databases, auth, monitoring, dev]
stack_assignments: "{{ vault_stack_assignments }}"

# Backup order: least-critical stacks first so auth/databases go down last.
# Defaults to reverse of stack_assignments if not specified.
# Keys are inventory_hostname (FQDNs) — must be set in vault as vault_backup_stack_order.
# Example structure:
#   vault_backup_stack_order:
#     <vps-fqdn>:       [vpn]
#     <odyssey-fqdn>:   [nfs, media, apps, infra]
#     <tantiveiv-fqdn>: [dev, monitoring, infra, databases, auth]
backup_stack_order: "{{ vault_backup_stack_order }}"

# Docker defaults — non-secret, shared across all stacks.
# docker_mem_limit default (3000m) suits 4GB hosts. Override in group_vars/<group>.yaml
# for hosts with more RAM (e.g. group_vars/tantiveiv.yaml sets docker_mem_limit: "10g").
docker_mem_limit: "3000m"
docker_tz: "America/Chicago"
docker_puid: "1000"
docker_pgid: "1000"
docker_umask: "022"
docker_appsdir: "/opt"
docker_restart: "always"
docker_postgres_user: "postgres"
docker_postgres_default_db: "postgres"
docker_adminer_design: "hydra"
docker_authentik_image: "ghcr.io/goauthentik/server"
docker_authentik_tag: "2025.12.4"
docker_email_host: "smtp.gmail.com"
docker_email_port: 587
docker_dozzle_level: "info"
docker_dozzle_remote_agent: "{{ vault_docker_dozzle_remote_agent }}"
docker_dozzle_hostname: "Odyssey"
