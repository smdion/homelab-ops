x-base: &base
  mem_limit: ${MEM_LIMIT}
  restart: ${RESTART}
x-env: &env
  TZ: ${TZ}
x-uid: &uid
  PUID: ${PUID}
  PGID: ${PGID}
  UMASK: ${UMASK}
x-envuid: &envuid
  <<:
  - *env
  - *uid
services:
  code-server:
    <<: *base
    container_name: code-server
    image: lscr.io/linuxserver/code-server
    network_mode: bridge
    ports:
    - 8443:8443
    environment:
      <<: *envuid
      PROXY_DOMAIN: ${CODESERVER_PROXY_DOMAIN}
      DEFAULT_WORKSPACE: ${CODESERVER_DEFAULT_WORKSPACE}
    volumes:
    - odyssey:/workspace/odyssey
    - vps:/workspace/vps
    - ${APPSDIR}/:/workspace/tantive-iv
    - ${APPSDIR}/code-server:/config
    healthcheck:
      test: ["CMD-SHELL", "ls /workspace/odyssey /workspace/vps > /dev/null 2>&1 || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
  netbootxyz:
    <<: *base
    container_name: netbootxyz
    image: netbootxyz/netbootxyz:latest
    network_mode: bridge
    ports:
      - 3002:3000
      - 69:69/udp
      - 8082:80
    environment:
      <<: *envuid
    volumes:
      - ${APPSDIR}/netboot/config:/config
      - ${APPSDIR}/netboot/assets:/assets
volumes:
  # NFS driver_opts (addr=...) are deployment-specific â€” defined via vault in
  # docker-compose.override.j2, which deploy_stacks.yaml templates to
  # docker-compose.override.yaml on the host. See DESIGN.md for details.
  odyssey:
  vps:
