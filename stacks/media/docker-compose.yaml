x-base: &base
  mem_limit: ${MEM_LIMIT}
  restart: ${RESTART}
x-env: &env
  TZ: ${TZ}
x-uid: &uid
  PUID: ${PUID}
  PGID: ${PGID}
  UMASK: ${UMASK}
x-envuid: &envuid
  <<:
  - *env
  - *uid
x-baseuid: &baseuid
  <<: *base
  environment:
    <<: *envuid
networks:
  homelab:
    external: true
services:
  tautulli:
    <<: *baseuid
    container_name: tautulli
    image: lscr.io/linuxserver/tautulli
    network_mode: bridge
    ports:
    - 8181:8181
    labels:
      homelab.backup.paths: "/opt/tautulli"
    volumes:
    - ${APPSDIR}/tautulli:/config
    healthcheck:
      test: ["CMD-SHELL", "curl -fs http://localhost:8181/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
  jellyseerr:
    <<: *base
    container_name: jellyseerr
    image: ${JELLYSEERR_IMAGE}:${JELLYSEERR_TAG}
    networks:
      - homelab
    labels:
      homelab.backup.paths: "/opt/jellyseerr"
      homelab.restore.app: "jellyseerr"
      homelab.restore.db_config: "db_primary_postgres"
      homelab.restore.db_names: "jellyseerr"
      homelab.restore.health_url: "http://localhost:5055/"
    ports:
    - 5055:5055
    environment:
      <<: *env
      DB_TYPE: ${JELLYSEERR_DB_TYPE}
      DB_HOST: ${POSTGRES_HOST}
      DB_PORT: ${POSTGRES_PORT}
      DB_USER: ${POSTGRES_USER}
      DB_PASS: ${POSTGRES_PASSWORD}
      DB_NAME: ${JELLYSEERR_POSTGRES_DB}
    volumes:
    - ${APPSDIR}/jellyseerr:/app/config
    healthcheck:
      test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost:5055/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
