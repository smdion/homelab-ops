# Rendered by deploy_stacks.yaml — do not edit manually
# Stack: infra | Host: {{ inventory_hostname }}

## Global
MEM_LIMIT={{ docker_mem_limit }}
RESTART={{ docker_restart }}
TZ={{ docker_tz }}
APPSDIR={{ docker_appsdir }}

## Docker Proxy
DP_CONTAINERS=1
DP_POST=1
DP_INFO=1
DP_VOLUMES=1
DP_SECRETS=1
DP_IMAGES=1
DP_NETWORKS=1
DP_ALLOW_RESTARTS=1

## Beszel Agent
BESZEL_LISTEN=45876
BESZEL_KEY={{ docker_beszel_key }}

## Dozzle — profiles select agent vs hub per host role
## Hub runs on apps (central log viewer); agents run on core + dev.
## DOZZLE_REMOTE_AGENT uses peer VIPs — stable across VM reprovisions.
DOZZLE_LEVEL=
DOZZLE_REMOTE_AGENT=
DOZZLE_HOSTNAME=
{% set _role = vault_vm_roles.get(inventory_hostname, '') %}
{% if _role == 'apps' %}
COMPOSE_PROFILES=hub
DOZZLE_LEVEL={{ docker_dozzle_level }}
{% if test_vm_role is defined %}{% set _subnet = ansible_default_ipv4.address.rsplit('.', 1)[0] %}DOZZLE_REMOTE_AGENT={{ _subnet }}.{{ docker_test_vip_offsets['core'] }}:7007,{{ _subnet }}.{{ docker_test_vip_offsets['dev'] }}:7007{% else %}DOZZLE_REMOTE_AGENT={{ vault_core_vip }}:7007,{{ vault_dev_vip }}:7007{% endif %}
DOZZLE_HOSTNAME=Apps
{% else %}
COMPOSE_PROFILES=agent
{% endif %}
